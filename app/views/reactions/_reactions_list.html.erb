<% grouped = message.grouped_reactions %>

<% grouped.each do |emoji, count| %>
  <% user_reacted = message.user_reacted?(current_user, emoji) %>
  <%= button_to room_message_reactions_path(message.room, message), 
      method: :post,
      params: { reaction: { emoji: emoji } },
      class: "inline-flex items-center gap-1 px-2 py-1 rounded-full text-sm transition-all #{user_reacted ? 'bg-primary/20 border-2 border-primary' : 'bg-dark-surface-hover border-2 border-transparent hover:border-dark-border'}" do %>
    <span class="text-base"><%= emoji %></span>
    <span class="text-xs font-medium"><%= count %></span>
  <% end %>
<% end %>

<!-- Add reaction button -->
<div class="relative inline-block" data-controller="dropdown">
  <button type="button" 
          class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-dark-surface-hover hover:bg-dark-surface transition-colors"
          data-action="click->dropdown#toggle">
    <svg class="w-4 h-4 text-dark-text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
    </svg>
  </button>
  
  <div class="hidden absolute top-full mt-2 left-0 z-50 bg-dark-surface border border-dark-border rounded-xl shadow-xl" 
       data-dropdown-target="menu" 
       style="min-width: 200px;">
    <div class="grid grid-cols-5 gap-2 p-2">
      <% Reaction::EMOJI_LIST.each do |emoji| %>
        <%= button_to room_message_reactions_path(message.room, message),
            method: :post,
            params: { reaction: { emoji: emoji } },
            class: "text-2xl hover:scale-125 transition-transform p-1 text-center" do %>
          <%= emoji %>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
