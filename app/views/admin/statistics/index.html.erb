<div class="p-6">
  <h1 class="text-2xl font-bold mb-6">Статистика</h1>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Messages per day -->
    <div class="card">
      <h2 class="font-semibold mb-4">Сообщения за последние 30 дней</h2>
      <div class="h-64 flex items-end gap-1">
        <% max_messages = @daily_messages.values.max || 1 %>
        <% 30.downto(0).each do |days_ago| %>
          <% date = days_ago.days.ago.to_date %>
          <% count = @daily_messages[date] || 0 %>
          <% height = (count.to_f / max_messages * 100).round %>
          <div class="flex-1 bg-primary rounded-t transition-all hover:bg-primary-hover" 
               style="height: <%= [height, 2].max %>%"
               title="<%= l(date, format: :short) %>: <%= count %> сообщений">
          </div>
        <% end %>
      </div>
      <div class="flex justify-between text-xs text-dark-text-muted mt-2">
        <span>30 дней назад</span>
        <span>Сегодня</span>
      </div>
    </div>

    <!-- New users per day -->
    <div class="card">
      <h2 class="font-semibold mb-4">Новые пользователи за последние 30 дней</h2>
      <div class="h-64 flex items-end gap-1">
        <% max_users = @daily_users.values.max || 1 %>
        <% 30.downto(0).each do |days_ago| %>
          <% date = days_ago.days.ago.to_date %>
          <% count = @daily_users[date] || 0 %>
          <% height = (count.to_f / max_users * 100).round %>
          <div class="flex-1 bg-secondary rounded-t transition-all hover:bg-purple-400" 
               style="height: <%= [height, 2].max %>%"
               title="<%= l(date, format: :short) %>: <%= count %> пользователей">
          </div>
        <% end %>
      </div>
      <div class="flex justify-between text-xs text-dark-text-muted mt-2">
        <span>30 дней назад</span>
        <span>Сегодня</span>
      </div>
    </div>

    <!-- Top rooms -->
    <div class="card">
      <h2 class="font-semibold mb-4">Самые активные чаты</h2>
      <div class="space-y-3">
        <% @top_rooms.each_with_index do |room, index| %>
          <div class="flex items-center gap-3">
            <span class="w-6 h-6 rounded-full bg-primary/20 flex items-center justify-center text-sm font-medium text-primary">
              <%= index + 1 %>
            </span>
            <div class="flex-1">
              <div class="font-medium truncate"><%= room.name %></div>
              <div class="text-sm text-dark-text-muted"><%= t("rooms.types.#{room.room_type}") %></div>
            </div>
            <span class="text-dark-text-muted"><%= room.messages_total %> сообщений</span>
          </div>
        <% end %>
        <% if @top_rooms.empty? %>
          <p class="text-dark-text-muted text-center py-4">Нет данных</p>
        <% end %>
      </div>
    </div>

    <!-- Storage by type -->
    <div class="card">
      <h2 class="font-semibold mb-4">Хранилище по типам файлов</h2>
      <div class="space-y-3">
        <% @storage_by_type.each do |content_type, size| %>
          <div class="flex items-center justify-between">
            <span class="text-dark-text-muted"><%= content_type || "Неизвестный тип" %></span>
            <span class="font-medium"><%= number_to_human_size(size) %></span>
          </div>
        <% end %>
        <% if @storage_by_type.empty? %>
          <p class="text-dark-text-muted text-center py-4">Нет загруженных файлов</p>
        <% end %>
      </div>
    </div>
  </div>
</div>
