<turbo-frame id="main-content" class="flex-1 flex flex-col overflow-hidden">
  <div class="flex-1 flex flex-col p-6 overflow-y-auto">
    <!-- Breadcrumb and Header -->
    <div id="folder-header">
      <!-- Breadcrumb -->
      <nav class="flex items-center gap-2 text-sm mb-6">
        <%= link_to folders_path, class: "text-dark-text-muted hover:text-primary" do %>
          <%= t("folders.index.title") %>
        <% end %>
        <% @folder.ancestors.each do |ancestor| %>
          <span class="text-dark-text-muted">/</span>
          <%= link_to ancestor.name, folder_path(ancestor), class: "text-dark-text-muted hover:text-primary" %>
        <% end %>
        <span class="text-dark-text-muted">/</span>
        <span class="font-medium"><%= @folder.name %></span>
      </nav>

      <!-- Header -->
      <div class="flex items-center justify-between mb-6">
        <h1 class="text-2xl font-bold"><%= @folder.name %></h1>
    <div class="flex gap-2">
      <%= link_to new_folder_path(parent_id: @folder.id), class: "btn btn-secondary btn-sm", data: { turbo_frame: "modal" } do %>
        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
        </svg>
        <%= t("folders.index.new") %>
      <% end %>
      
      <%= form_with url: folder_attachments_path(@folder), method: :post, multipart: true, id: "file-upload-form" do |f| %>
        <label class="btn btn-primary btn-sm cursor-pointer">
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
          </svg>
          <%= t("folders.show.upload") %>
          <%= f.file_field :files, multiple: true, class: "hidden", onchange: "this.form.requestSubmit()" %>
        </label>
      <% end %>
      
      <%= form_with url: folder_attachments_path(@folder), method: :post, multipart: true, id: "folder-upload-form", data: { turbo: false } do |f| %>
        <label class="btn btn-secondary btn-sm cursor-pointer">
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
          </svg>
          Загрузить папку
          <%= f.file_field :files, multiple: true, webkitdirectory: true, class: "hidden", onchange: "addFilePaths(this)" %>
        </label>
        <div id="file-paths-container"></div>
      <% end %>
      <script>
        function addFilePaths(input) {
          const form = input.form;
          const container = form.querySelector('#file-paths-container');
          container.innerHTML = ''; // Clear previous paths
          
          for (let i = 0; i < input.files.length; i++) {
            const file = input.files[i];
            const path = file.webkitRelativePath || file.name;
            
            // Add hidden field with file path
            const hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = 'file_paths[]';
            hiddenInput.value = path;
            container.appendChild(hiddenInput);
          }
          
          form.submit();
        }
      </script>
      <%= link_to new_share_link_folder_path(@folder), class: "btn btn-secondary btn-sm", data: { turbo_frame: "modal" } do %>
        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
        </svg>
        <%= t("folders.actions.share") %>
      <% end %>
      <div class="relative" data-controller="dropdown">
        <button class="btn-icon btn-ghost" data-action="click->dropdown#toggle">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"/>
          </svg>
        </button>
        <div class="dropdown hidden" data-dropdown-target="menu">
          <%= link_to edit_folder_path(@folder), class: "dropdown-item flex items-center gap-2", data: { turbo_frame: "modal" } do %>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
            </svg>
            <%= t("folders.actions.rename") %>
          <% end %>
          <%= button_to folder_path(@folder), method: :delete, class: "dropdown-item flex items-center gap-2 w-full text-left text-error", data: { turbo_confirm: t("folders.actions.confirm_delete") } do %>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
            </svg>
            <%= t("folders.actions.delete") %>
          <% end %>
        </div>
      </div>
    </div>

  <!-- Share link section -->
  <div id="folder_share_link" class="mb-4"></div>
    </div>

  <!-- Subfolders -->
  <div id="subfolders-section">
    <%= render "folders/subfolders", subfolders: @subfolders %>
  </div>

  <!-- Files -->
  <h2 class="font-semibold text-dark-text-muted mb-3"><%= t("attachments.upload") %></h2>
  <div id="attachments">
    <%= render "folders/attachments", attachments: @attachments %>
  </div>
  </div>
</turbo-frame>
